<div class="container">
  <h2>Shopping Cart</h2>

  @if (cartService.items().length === 0) {
    <p>Your cart is empty</p>
  } @else {
  @for (item of cartService.items(); track item.product.id) {
    <div class="cart-item">
      <img [src]="item.product.imageUrl || 'https://placehold.co/600x400'" [alt]="item.product.name" class="cart-item-image">
      <div class="cart-item-details">
        <h3 class="cart-item-name">{{ item.product.name }}</h3>
        <p class="cart-item-price">${{ item.product.price.toFixed(2) }}</p>
      </div>
      <div class="cart-item-actions">
        <input type="number" [ngModel]="item.quantity" (ngModelChange)="updateQuantity(item.product.id, $event)" min="0"
          class="quantity-input">
        <button (click)="removeItem(item.product.id)" class="btn btn-danger">
          Remove
        </button>
      </div>
    </div>
  }

  <div class="discount-form">
    <form [formGroup]="discountForm" (ngSubmit)="applyDiscount()" class="discount-form">
      <input formControlName="code" placeholder="Enter discount code" class="input discount-input">
      <button type="submit" [disabled]="!discountForm.valid" class="btn btn-primary">
        Apply
      </button>
    </form>
  </div>

  @if (discountMessage()) {
    <p [class]="discountSuccess() ? 'success-message' : 'error-message'">
      {{ discountMessage() }}
    </p>
  }

  <div class="cart-summary">
    <p>Subtotal: ${{ cartService.subtotal().toFixed(2) }}</p>
    @if (discountAmount() > 0) {
      <p class="success-message">
        Discount: -${{ discountAmount().toFixed(2) }}
      </p>
    }
    <p class="cart-total">
      Total: ${{ (cartService.subtotal() - discountAmount()).toFixed(2) }}
    </p>
  </div>
  }
</div>
